<!DOCTYPE HTML>
<html>
  <head>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="wrapper">
      <div class="contacts">
        <aside data-component="groups">
          <h1>Groups</h1>
          <table>
            <thead>
              <tr>
                <td>Name</td>
              </tr>
            </thead>
            <tbody data-render>
              <tr> </tr>
            </tbody>
          </table>
        </aside>
        <main data-component="people">
          <h1 class="title">A small demonstration of the scoped component pattern</h1>
          <table>
            <thead>
              <tr>
                <td>Name</td>
                <td>Email</td>
              </tr>
            </thead>
            <tbody data-render>
              <tr>
                <td colspan="2">Please select a group from the left</td>
              </tr>
            </tbody>
          </table>
        </main>
      </div>
    </div>

    <script>
      try       { eval("() => { return }") }
      catch (e) { document.body.innerHTML = "<h1>Please open this page in a browser that supports ES6</h1>" }
    </script>
    <script src="kickstart.js"></script>
    <script id="contacts">
      var groups = [
        {
          name: "ABC Company",
          contacts: [
            {
              name: "John Smith",
              email: "jsmith@example.com"
            },
            {
              name: "Jane Doe",
              email: "jdoe@example.com"
            },
            {
              name: "Delphi Grant",
              email: "dgrant@example.com"
            },
            {
              name: "Adam Grant",
              email: "agrant@example.com"
            },
            {
              name: "Sally Kochanowicz",
              email: "skochanowicz@example.com"
            },
            {
              name: "Dusty Thompson",
              email: "dthompson@example.com"
            }
          ]
        },
        {
          name: "Family",
          contacts: [
            {
              name: "Bob Hart",
              email: "jsmith@example.com"
            },
            {
              name: "Sylviane Joseph",
              email: "sjoseph@example.com"
            },
            {
              name: "Yonel Clark",
              email: "yclark@example.com"
            },
            {
              name: "Lydia Fleck",
              email: "lfleck@example.com"
            },
            {
              name: "Luke Menton",
              email: "lmenton@example.com"
            },
            {
              name: "Priscilla Benson",
              email: "pbenson@example.com"
            }
          ]
        },
        {
          name: "Golf Buddies",
          contacts: [
            {
              name: "Rachel Schuemacher",
              email: "rschuemacher@example.com"
            },
            {
              name: "David Portille",
              email: "dportille@example.com"
            },
            {
              name: "Clarissa Esplandall",
              email: "cesplandall@example.com"
            },
            {
              name: "Frank Munster",
              email: "fmunster@example.com"
            },
            {
              name: "Sally Chen",
              email: "schen@example.com"
            },
            {
              name: "Meghan Pratten",
              email: "mpratten@example.com"
            }
          ]
        },
        {
          name: "High School Friends",
          contacts: [
            {
              name: "Finn Broen",
              email: "fbroen@example.com"
            },
            {
              name: "Chelsea Atherton",
              email: "catherton@example.com"
            },
            {
              name: "Dina Merril",
              email: "dmerril@example.com"
            },
            {
              name: "Edgar Fiest",
              email: "efiest@example.com"
            },
          ]
        }
      ]
    </script>
    <script>
      // Pass in a group of contacts to populate table
      var mapPeople = (contacts, groupName) => {
        k$.component("people", function(_$) {
          peopleMarkup = [""].concat(contacts).reduce((markup, contact, index) => {
            return `
              ${markup}
              <tr class="row" data-person="${index - 1}">
                <td>${contact.name}</td>
                <td>${contact.email}</td>
              </tr>
            `;
          });

          _$("tbody").innerHTML = peopleMarkup;
          _$(".title").innerHTML = groupName;
        });
      };

      k$.component("groups", (_$) => {
        // Convert JSON to <table>
        var groupsMarkup = [""].concat(groups).reduce((markup, group, index) => {
          return `
            ${markup}
            <tr class="row" data-group="${index - 1}">
              <td>${group.name}</td>
            </tr>
          `;
        });

        // Component-scoped events
        _$("tbody").innerHTML = groupsMarkup;
        _$("tbody").addEventListener("click", (e) => {
          e.stopPropagation();
          var group = groups[e.target.parentNode.dataset.group];
          mapPeople(group.contacts, group.name)
        })
      });
    </script>
  </body>
</html>
